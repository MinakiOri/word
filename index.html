<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/Shift-JIS; charset=utf-8 width=device-width, initial-scale=1.0">
<title>WordRmember</title>
</head>
<header>
	<h1 style="text-align: center"><font color = "white">Word</font></h1>
</header>

    <body>
        <table style="border:none" ><tr>
            <td style="border:none"><div id = "nown" >0</div></td>
            <td style="border:none">/</td>
            <td style="border:none"><div id ="alln">0</div></td>
            <td style="border:none"> &emsp; Ture &emsp;</td>
            <td style="border:none"><div id ="anser1">0</div></td>
            <td style="border:none"> &emsp; False &emsp;</td>
            <td style="border:none"><div id ="anser2">0</div></td>
        </tr></table>
        <table id = "tb" style="text-align: center"></table>
        <div id = "test" style="text-align: center">Anser</div>
        <div style="text-align: center">
            <button style="text-align: center" onclick="lastF()">Change</button>
        </div>  
    </body>
    <footer>
        <div style="text-align: right" id = "cou"><font color = "black"></font></div>
        <div style="text-align: right" id = "time"><font color = "white"></font></@>
    </footer>
</html>
    

<style type = "text/css">
    *{
        margin:0;
        padding: 0px;
    }
    body { 
    -webkit-text-size-adjust: 100%;
    }
    header {
	position: relative;
	height: 10vh;
    width: 100%;
    background: url(head2.jpg) center / cover;
    }
    footer {
	position: relative;
	height: 10vh;
    width: 100%;
    background: url(head2.jpg) center / cover;
    position: absolute;
    bottom: 0; 
    }
    td {
      margin:auto;
      border: solid 1px;
      width:auto;
   }
   table{
      margin:auto;
      border: solid 1px;
      border-collapse:  collapse;
      font-size:20px
    }
    button{
        font-size: 20px;
    }
</style>
<script type = "text/javascript">
    var words = new Array();
    var r = new Array();
    var cellf = new Array();
    var cellid = "tr"; 
    var count = 0;
    var ansern = [0,0];
    var flag = 0;
    var conserv = 0;
    var ff = 1;
    function getCSV(){
        var req = new XMLHttpRequest();
        req.open("get","toeicword.csv",true)
        req.overrideMimeType('text/Shift-JIS; charset=utf-8');
        req.send(null);
        req.onload = function(){
            words = csvtoarray(req.responseText);
        }
    }
    function csvtoarray(str){
        var result = [];
        var tmp = str.split("\n");
        for(var i=0;i<tmp.length;++i){
            result[i]=tmp[i].split(',');
        }
        tbch(result);
        return result;
    }
    document.addEventListener('DOMContentLoaded',function(){
        getCSV();
    },false);
    function tbch(result){
        var ta = document.createElement("table");
        r = ram(result.length);
        document.getElementById("alln").innerHTML = r.length;
        for(var i=0;i<5;i++){
            var tr = document.createElement("tr");
            cellf[i] = [];
            for(var j=0;j<5;j++){
                var td = document.createElement("td");
                td.textContent = String(r[i*5+j]).padStart( 2 , "0" )+":"+result[r[i*5+j]][1];
                td.id = "tb:"+i+":"+j;
                cellid = td.id;
                td.onclick = function(){
                    cellid = this.id;
                    col();
                };
                var bu1 = document.createElement("button");
                bu1.innerHTML = "T";
                bu1.id = "bu1:"+i+":"+j;
                bu1.onclick = function(){
                    cellid = this.id;
                    AnserT();
                };
                var bu2 = document.createElement("button");
                bu2.innerHTML = "F";
                bu2.id = "bu2:"+i+":"+j;
                bu2.onclick = function(){
                    cellid = this.id;
                    AnserF();
                }
                tr.appendChild(td);
                tr.appendChild(bu1);
                tr.appendChild(bu2);
                cellf[i][j] = 0;
                count ++;
            }
            ta.appendChild(tr);
        }
        document.getElementById("tb").appendChild(ta);
        document.getElementById("nown").innerHTML = (ansern[0]+ansern[1]);
    }
    function ram(num){
        var ar = [...Array(num).keys()];
        for(var i=0;i<num;i++){
            var rn = Math.floor(Math.random()*num);
            var t = ar[i];
            ar[i] = ar[rn];
            ar[rn] = t;
        }
        return ar;
    }
    var sw = 0;
    function col(){
        if(r.length > (ansern[0]+ansern[1]) && ansern[1]<25){
            var cell = document.getElementById(cellid);
            var num = cell.innerHTML.split(':');
            if(sw == 0){
            document.getElementById("test").innerHTML=words[parseInt(num[0])][2];
            sw = 1;
            }
            else if(sw == 1){
                document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
                sw = 0;
            }
        }
    }
    function AnserT(){
        sw = 0;
        if(flag == 0){
        var cellst = cellid.split(":");
        var tag = "tb:"+cellst[1]+":"+cellst[2];
        var cell = document.getElementById(tag);
        document.getElementById("test").innerHTML =tag;
        var num = cell.innerHTML.split(':');
        if(r.length <= (ansern[0]+ansern[1])){
            cell.style.backgroundColor = "green";
            finish();
        }
        else if( (ansern[0]+ansern[1])-(ff*25) == 0){
            change();
        }
        else if(cellf[cellst[1]][cellst[2]]==0){
            cell.style.backgroundColor = "green";
            cellf[cellst[1]][cellst[2]] = 1;
            ansern[0]++;
            conserv = num;
            document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
        }
        /*else if(r.length <= count && cellf[cellst[1]][cellst[2]]==0){
            cell.style.backgroundColor = "green";
            cellf[cellst[1]][cellst[2]] = 1;
            ansern[0]++;
            conserv = num;
            document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
        }
        else if(cellid != "tr" && cellf[cellst[1]][cellst[2]]==0){
            cell.textContent = String(r[count]).padStart( 2 , "0" )+":"+words[r[count]][1];
            ansern[0]++;
            count++;
            conserv = num;
            document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
        }*/
        document.getElementById("nown").innerHTML = (ansern[0]+ansern[1]);
        document.getElementById("anser1").innerHTML = ansern[0];
        document.getElementById("anser2").innerHTML = ansern[1];
    }
    }
    function AnserF(){
        sw = 0;
        if(flag == 0){
        var cellst = cellid.split(":");
        var tag = "tb:"+cellst[1]+":"+cellst[2];
        var cell = document.getElementById(tag);
        var num = cell.innerHTML.split(':');
        if(r.length <= (ansern[0]+ansern[1])){
            cell.style.backgroundColor = "red";
            finish();
        }
        else if( (ansern[0]+ansern[1]) - (ff*25) == 0){
            change();
        }
        else if(cellf[cellst[1]][cellst[2]]==0){
            cell.style.backgroundColor = "red";
            cellf[cellst[1]][cellst[2]] = 2;
            ansern[1]++;
            document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
        }
        document.getElementById("nown").innerHTML = (ansern[0]+ansern[1]);
        document.getElementById("anser1").innerHTML = ansern[0];
        document.getElementById("anser2").innerHTML = ansern[1];
    }
    }
    function lastF(){
        sw = 0;
        if(flag == 0){
        var cellst = cellid.split(":");
        var tag = "tb:"+cellst[1]+":"+cellst[2];
        var cell = document.getElementById(tag);
        var num = cell.innerHTML.split(':');
        if(r.length <= (ansern[0]+ansern[1])){
            cell.style.backgroundColor = "red";
            finish();
        }
        else if( (ansern[0]+ansern[1])-(ff*25) == 0){
            change();
        }
        else if(cellf[cellst[1]][cellst[2]]==1){
            cell.style.backgroundColor = "red";
            cellf[cellst[1]][cellst[2]] = 2;
            ansern[1]++;
            ansern[0]--;
            document.getElementById(tag).innerHTML=num[0]+":"+words[parseInt(conserv[0])][1];
        }
        document.getElementById("nown").innerHTML = (ansern[0]+ansern[1]);
        document.getElementById("anser1").innerHTML = ansern[0];
        document.getElementById("anser2").innerHTML = ansern[1];
    }
    }
    function finish(){
        document.getElementById("test").innerHTML = "Finish"
        flag = 1;
    }
    function change(){
        for(var i = 0;i<5;i++){
            for(var j = 0;j<5;j++){
                if(r.length <= (ansern[0]+ansern[1])){
                var tagt = "tb:"+i+":"+j;
                var cell = document.getElementById(tagt);
                cell.textContent = String(r[(ansern[0]+ansern[1])+i*5+j])+":"+words[r[(ansern[0]+ansern[1])+i*5+j]][1];
                cell.style.backgroundColor = "white";
                cellf[i][j]=0;
                }
            }
        }
        ff++;
        document.getElementById("anser1").innerHTML = ansern[0];
        document.getElementById("anser2").innerHTML = ansern[1];
    }
    function Time() {
    var realTime = new Date();
    var hour = realTime.getHours();
    var minutes  = realTime.getMinutes();
    var seconds  = realTime.getSeconds();
    var text = hour + ":" + minutes + ":" + seconds;
    document.getElementById("time").innerHTML = text;
    document.getElementById("time").style.color = "white";
    }
    setInterval('Time()',1000);
    const cookies = document.cookie; // クッキーを全部取得
    const cookiesArray = cookies.split('; '); // 'キー=値'の形で分割して配列に入れる

    for (const cookie of cookiesArray) {
    const cookieArray = cookie.split('='); // キーと値をさらに分割して配列に入れる

    if (cookieArray[0] !== 'count') {
    document.cookie = 'count=1; path=/';
    document.getElementById("cou").innerHTML = "1th time";
    document.getElementById("cou").style.color = "white";
    }

    if (cookieArray[0] === 'count') {
    let accessCount = parseInt(cookieArray[1]); 
    accessCount++;
    document.cookie = 'count=' + accessCount + '; path=/';
    document.getElementById("cou").innerHTML = accessCount +"th time";
    document.getElementById("cou").style.color = "white";
    }
    }
</script>