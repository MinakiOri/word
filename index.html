<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/Shift-JIS; charset=utf-8" />
<title>ToeicWord</title>
</head>
<body>
 <p><font size="3 color="black">TOEIC</font></p>
 <nobr id = "nown">0</nobr>/<nobr id ="alln">0</nobr>
 <table id = "tb"></table>
 <div id = "test">Anser</div>
 <button onclick="AnserT()">Ture</button>
 <button onclick="AnserF()">False</button> 

</body>
</html>
<script type = "text/javascript">
    var words = new Array();
    var r = new Array();
    var cellf = new Array();
    var cellid = "tr"; 
    var count = 0;
    var ansern = [0,0];
    var flag = 0;
    function getCSV(){
        var req = new XMLHttpRequest();
        req.open("get","toeicword.csv",true)
        req.overrideMimeType('text/Shift-JIS; charset=utf-8');
        req.send(null);
        req.onload = function(){
            words = csvtoarray(req.responseText);
        }
    }
    function csvtoarray(str){
        var result = [];
        var tmp = str.split("\n");
        for(var i=0;i<tmp.length;++i){
            result[i]=tmp[i].split(',');
        }
        tbch(result);
        return result;
    }
    document.addEventListener('DOMContentLoaded',function(){
        getCSV();
    },false);
    function tbch(result){
        var ta = document.createElement("table");
        var r = ram(result.length);
        document.getElementById("alln").innerHTML = r.length;
        for(var i=0;i<5;i++){
            var tr = document.createElement("tr");
            cellf[i] = [];
            for(var j=0;j<5;j++){
                var td = document.createElement("td");
                td.textContent = String(r[i*5+j]).padStart( 2 , "0" )+":"+result[r[i*5+j]][1];
                td.id = "tb:"+i+":"+j;
                cellid = td.id;
                td.onclick = function(){
                    cellid = this.id;
                    col();
                };
                var bu1 = document.createElement("button");
                bu1.innerHTML = "T";
                bu1.id = "bu1:"+i+":"+j;
                bu1.onclick = function(){
                    cellid = this.id;
                    AnserT();
                };
                var bu2 = document.createElement("button");
                bu2.innerHTML = "F";
                bu2.id = "bu2:"+i+":"+j;
                bu2.onclick = function(){
                    cellid = this.id;
                    AnserF();
                }
                tr.appendChild(td);
                tr.appendChild(bu1);
                tr.appendChild(bu2);
                cellf[i][j] = 0;
                count ++;
            }
            ta.appendChild(tr);
        }
        document.getElementById("tb").appendChild(ta);
        document.getElementById("nown").innerHTML = (ansern[0]+ansern[1]);
    }
    function ram(num){
        var ar = [...Array(num).keys()];
        for(var i=0;i<num;i++){
            var rn = Math.floor(Math.random()*num);
            var t = ar[i];
            ar[i] = ar[rn];
            ar[rn] = t;
        }
        r = ar;
        return ar;
    }
    var sw = 0;
    function col(){
        if(r.length > (ansern[0]+ansern[1]) && ansern[1]<25){
            var cell = document.getElementById(cellid);
            var num = cell.innerHTML.split(':');
            if(sw == 0){
            document.getElementById("test").innerHTML=words[parseInt(num[0])][2];
            sw = 1;
            }
            else if(sw == 1){
                document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
                sw = 0;
            }
        }
    }
    function AnserT(){
        sw = 0;
        if(flag == 0){
        var cellst = cellid.split(":");
        var tag = "tb:"+cellst[1]+":"+cellst[2];
        var cell = document.getElementById(tag);
        var num = cell.innerHTML.split(':');
        if(r.length <= (ansern[0]+ansern[1])){
            cell.style.backgroundColor = "green";
            finish();
        }
        else if(ansern[1]>=25){
            finish();
        }
        else if(r.length <= count && cellf[cellst[1]][cellst[2]]==0){
            cell.style.backgroundColor = "green";
            cellf[cellst[1]][cellst[2]] = 1;
            ansern[0]++;
            document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
        }
        else if(cellid != "tr" && cellf[cellst[1]][cellst[2]]==0){
            cell.textContent = String(r[count]).padStart( 2 , "0" )+":"+words[r[count]][1];
            cellid = "tr";
            ansern[0]++;
            count++;
            document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
        }
        document.getElementById("nown").innerHTML = (ansern[0]+ansern[1]);
    }
    }
    function AnserF(){
        sw = 0;
        if(flag == 0){
        var cellst = cellid.split(":");
        var tag = "tb:"+cellst[1]+":"+cellst[2];
        var cell = document.getElementById(tag);
        if(r.length <= (ansern[0]+ansern[1])){
            cell.style.backgroundColor = "red";
            finish();
        }
        else if(ansern[1]>=25){
            finish();
        }
        else if(cellf[cellst[1]][cellst[2]]==0){
            cell.style.backgroundColor = "red";
            cellf[cellst[1]][cellst[2]] = 1;
            ansern[1]++;
            document.getElementById("test").innerHTML=words[parseInt(num[0])][4];
        }
        document.getElementById("nown").innerHTML = (ansern[0]+ansern[1]);
    }
    }
    function finish(){
        document.getElementById("test").innerHTML = "Finish"
        flag = 1;
    }
</script>